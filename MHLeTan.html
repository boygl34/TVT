<!DOCTYPE html>
<html>

<head>
  <base target="_top">

  <!--INCLUDE REQUIRED EXTERNAL JAVASCRIPT AND CSS LIBRARIES-->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">


  <!-- See JavaScript.html file -->
  <style>
    #dataTable td:nth-child(10) {
      font-size: 0.5px;
    }

    #dataTable td:nth-child(1) {
      font-size: 35px;
      text-align: left;
      width: 25%;
    }

    #dataTable td:nth-child(2) {
      font-size: 20px;
      width: 7%;
    }


    #dataTable td:nth-child(4) {
      font-size: 20px;
      text-align: left;
      width: 5%;
    }

    #dataTable td:nth-child(9) {
      font-size: 10px;
      color: black;
      width: 2%;
    }

    table.dataTable thead {
      background-color: #1155cc;
      font-size: 15px;
    }


    .DangTiepNhan {
      color: #00ff00;
    }

    .SapTiepNhan {
      color: #ff6d01;
    }

    .ChoTiepNhan {
      color: #3deedf;
    }

    .Lever4 {
      background-color: red;
    }

    .Lever3 {
      background-color: pink;
    }

    .CanhBao {
      font-size: 55px;
    }

    .Lever2 {
      background-color: yellow;
    }

    .Lever1 {
      background-color: #00ff00;
    }

    #dataTable td {
      height: 50px;
      vertical-align: middle;

      font-size: 15.5px;
    }
  </style>
</head>

<body style="font-weight:bold;text-align:center;vertical-align: middle ;width:100%;background-color:black">
  <h3 style="color:white">THÔNG TIN TIẾP NHẬN DỊCH VỤ</h3>
  <div class="container-fluid">
    <div id="dataTable" class="table">
      <table id="data-table" onclick="clickTableTiepNhan()" class=" table table-dark  table-sm table-hover  row-border"
        style="font-weight:bold;text-align:center;vertical-align: middle ;width:100%;background-color:black">
        <!-- TABLE DATA IS ADDED BY THE showData() JAVASCRIPT FUNCTION ABOVE -->
        <thead style="background-color:#1155cc;font-size: 15px">
          <tr style="font-size:8px">
            <th>Biển Số</th>
            <th>Số Thẻ</th>
            <th>Tên KH</th>
            <th>Giờ H</th>
            <th>LH GJ</th>

            <th>Cố Vấn</th>
            <th>Trạng Thái</th>
            <th>TG</th>

          </tr>
        </thead>
        <tbody id="table-body-Tim-xe" style="font-size:14px">
        </tbody>
      </table>
    </div>
    <br><!-- See DataTable.html File -->
  </div>
  <script>

    var useCaher
    var urlTX = "https://serveriotvt2.glitch.me/MangHinh"

    setInterval(function () { getData(urlTX) }, 10000);
    getData(urlTX)


    function getData(url) {
      fetch(url)
        .then(response => response.json())
        .then(data => {
          console.log(data);
          useCaher = data.TrongXuong
          showData()
        });
    }
    function showData() {
      // tieude.innerHTML = "Cố Vấn "+ Doingay()
      var dataArray = useCaher
      var dataArray0 = dataArray.filter(function (r) { return ((r.TrangThaiXuong === "Chờ Tiếp Nhận" || r.TrangThaiXuong === "Chuẩn Bị Tiếp")) })
      dataArray0 = dataArray0.sort(function (a, b) { return (a.ThoiDiemGapLeTan.toLowerCase() < b.ThoiDiemGapLeTan.toLowerCase() ? 1 : -1); })
      dataArray0 = dataArray0.sort(function (a, b) { return (a.TrangThaiXuong.toLowerCase() < b.TrangThaiXuong.toLowerCase() ? 1 : -1); })
      var tbodyTim = document.getElementById('table-body-Tim-xe')
      tbodyTim.innerHTML = ""

      dataArray0.forEach(function (r) {
        var row = document.createElement("tr");
        var BienSo = document.createElement("td");
        BienSo.innerHTML = r.BienSoXe
        if (r.TrangThaiHen == "Đúng Hẹn") { BienSo.innerHTML = "[H] " + r.BienSoXe }
        if (r.TrangThaiHen == "Trễ Hẹn") { BienSo.innerHTML = "[T] " + r.BienSoXe }
        if (r.TrangThaiHen == "Đến Sớm") { BienSo.innerHTML = "[S] " + r.BienSoXe }
        if (r.TrangThaiHen == "Không Đúng Hẹn") { BienSo.innerHTML = "[h] " + r.BienSoXe }
        if (r.NoiDungHen && (r.NoiDungHen.toUpperCase()).indexOf("VIP") >= 0) { BienSo.innerHTML = "[V] " + r.BienSoXe }
        row.appendChild(BienSo);
        var SoThe = document.createElement("td");
        SoThe.innerHTML = r.SoThe
        row.appendChild(SoThe);
        var TenKH = document.createElement("td");
        TenKH.innerHTML = r.TenKhachHang
        row.appendChild(TenKH);
        var TenKH = document.createElement("td");
        TenKH.innerHTML = r.ThoiDiemDatHen ? Doingay(r.ThoiDiemDatHen) : ""
        row.appendChild(TenKH);
        // var GioHen = document.createElement("td");
        // if (r.ThoiGianHen) { GioHen.innerHTML = Doingay(DoiNgayDangKy(r.ThoiGianHen)) } else { GioHen.innerHTML = "" }
        // row.appendChild(GioHen);
        var LHGJ = document.createElement("td");
        if (r.LoaiHinhSuaChua) { LHGJ.innerHTML = r.LoaiHinhSuaChua } else { LHGJ.innerHTML = "" }
        row.appendChild(LHGJ);

        var CoVan = document.createElement("td");
        if (r.CoVanDichVu) { CoVan.innerHTML = r.CoVanDichVu } else { CoVan.innerHTML = "" }
        row.appendChild(CoVan);
        var trangtx = document.createElement("td");
        if (r.TrangThaiXuong == "Chờ Tiếp Nhận") { trangtx.innerHTML = "Chờ Tiếp Nhận"; row.setAttribute('class', 'SapTiepNhan') }
        else if (r.TrangThaiXuong == "Chuẩn Bị Tiếp") { trangtx.innerHTML = "Chuẩn Bị Tiếp"; row.setAttribute('class', 'DangTiepNhan') }
        else { trangtx.innerHTML = "" }
        row.appendChild(trangtx);
        var TGCHO = document.createElement("td");
        var TG
        if (r.TrangThaiXuong == "Chờ Tiếp Nhận") { TG = Math.round((new Date().valueOf() - new Date(r.ThoiDiemGapLeTan).valueOf()) / (60 * 1000) * 1) / 1 }
        if (r.TrangThaiXuong == "Chuẩn Bị Tiếp") { TG = Math.round((new Date().valueOf() - new Date(r.ThoiDiemGapLeTan).valueOf()) / (60 * 1000) * 1) / 1 }
        TGCHO.innerHTML = TG
        if (TG < 10) { TGCHO.setAttribute('class', 'Lever1') }
        if (TG >= 10 && TG < 20) { TGCHO.setAttribute('class', 'Lever2') }
        if (TG >= 20 && TG < 30) { TGCHO.setAttribute('class', 'Lever3') }
        if (TG >= 30) { TGCHO.setAttribute('class', 'CanhBao'); TGCHO.setAttribute('class', 'Lever4') }
        row.appendChild(TGCHO);

        var MaSo = document.createElement("td");
        if (r.MaSo) { MaSo.innerHTML = r.MaSo } else { MaSo.innerHTML = "" }
        row.appendChild(MaSo);
        tbodyTim.appendChild(row)

      })




    }

    function DoiNgayDangKy(ngayhen) {
      var aa
      if (ngayhen) {
        var Thang = ngayhen.slice(3, 5)
        var Ngay = ngayhen.slice(0, 2)
        var Nam = ngayhen.slice(6, 10)
        var Gio = ngayhen.slice(11, 13)
        var Phut = ngayhen.slice(14, 16)
        var ThoiGianMoi = Nam + "-" + Thang + "-" + Ngay + "T" + Gio + ":" + Phut + ":00Z"
        var aa = new Date(ThoiGianMoi)
        aa = new Date(aa - 7 * 60 * 60 * 1000)
      }
      return aa;
    }
    function Doingay(use) {

      use = new Date(use)
      var Thang = use.getMonth() + 1
      var Ngay = use.getDate()
      var Nam = use.getFullYear()
      var Gio = use.getHours()
      var Phut = use.getMinutes()
      if (Thang < 10) { Thang = "0" + Thang }
      if (Ngay < 10) { Ngay = "0" + Ngay }
      if (Gio < 10) { Gio = "0" + Gio }
      if (Phut < 10) { Phut = "0" + Phut }
      var ThoiGian = Gio + ":" + Phut
      return ThoiGian
    }
  </script>

</body>

</html>