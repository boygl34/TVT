<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
<script src="js/intascan.js"></script>
<script src="js/intascan.min.js"></script>

<style>



.column {
  float: left;
  width: 33.3%;
  margin-bottom: 16px;
  padding: 0 8px;
}

@media screen and (max-width: 650px) {
  .column {
    width: 100%;
    display: block;
  }
}

.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
}

.container {
  padding: 0 16px;
}

.container::after, .row::after {
  content: "";
  clear: both;
  display: table;
}

.title {
  color: grey;
}

.button {
  border: none;
  outline: 0;
  display: inline-block;
  padding: 8px;
  color: white;
  background-color: #000;
  text-align: center;
  cursor: pointer;
  width: 100%;
}

.button:hover {
  background-color: #555;
}
.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 70%;
}

</style>
</head>
<body>
    <div class="container">
        <div id="Scanvideo" > 
          <div class="spinner-border" role="status" id="loading"style="display: none;">
            <span class="sr-only">Loading...</span>
          </div>
            <button class="button"onclick="showScan()">Scan</button> 
               
            <video id="preview" playsinline="true" class="center" ></video>
            <div class="row" id="Checkshet" style="display: none;">
            </div>
        </div>
</div>







</body>


<script>
     
   var url = "https://big-road-newsstand.glitch.me/CheckSheet/"



    var scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false  })
      scanner.addListener('scan',function(content){
        document.getElementById("loading").style.display = "block"
        scanner.stop() 
        
        try{
            $.get(url+content, function(ketqua) {
                document.getElementById("preview").style.display = "none"
                
                if(ketqua.PhanLoai=="ThietBiDungChung"){setthietbidungchung(ketqua)}
                if(ketqua.PhanLoai=="Khu Vực Dùng Chung"){setkhuvucdungchung(ketqua)}
                document.getElementById("loading").style.display = "none"
            });
        }catch(error) {
                    alert("Lỗi : "+error)
                  }
    });




    function showScan(){ 
      document.getElementById("preview").style.display = "block"
      document.getElementById("Checkshet").style.display = "none";
    Instascan.Camera.getCameras().then(function (cameras) {
                 if (cameras.length > 0) {
                     scanner.start(cameras[0]);
                     //load2.hidden =true
                 }
                 else {
            alert('No Back camera found!');       
                 }
             }).catch (function (e) {
                console.error('No cameras found.');
             });
    }
    function setkhuvucdungchung(ketqua){
            $("#Checkshet").html(
                //'<div class="column">'+
                    '<div class="card">'+
                        '<img src="images/'+ketqua.id+'.jpg" alt="'+ketqua.id+'" style="width:100%">'+
                        '<div class="container">'+
                            '<h2 id="TenThietBi">'+ketqua.TenKhuVuc+'</h2>'+
                            '<h3 id="PhanLoai">'+ketqua.PhanLoai+'</h3>'+
                            set5sKhuVuc(ketqua.TrangThietBi)+
                            '<label class="custom-control-label" for="checkbox-hen">Ghi Chú Bất Thường</label>'+
                            ' <input id="GhiChu" type="text" class="custom-control-input" >'+
                            '<p><button class="button" onclick="writeData()">Check Sheet!!</button></p>'+
                            
                        '</div>'+
                    //'</div>'+
                '</div>')
      document.getElementById("Checkshet").style.display = "block";
    }

    function set5sKhuVuc(value){     
    var cac5s ='<p class="title"></p>'
    for(a in value){
     var value2 = value[a] 
     for(b in value2){
      //cac5s +='<p class="title">'+"+ "+value2[b].TenThietBi+'</p>'
      cac5s +=  '<div class="custom-control custom-checkbox checkbox-xl">'+
              '<label class="custom-control-label" for="checkbox-hen">'+ value2[b].TenThietBi +'</label>'+
              ' <input type="checkbox" class="custom-control-input" >'+
            '</div>'


      for (c in value2[b].tieuchuan5s){
      cac5s +='<p>&nbsp;&nbsp;&nbsp;-'+value2[b].tieuchuan5s[c]+'</p>'}
     }
      }
      return cac5s
    }






    function setthietbidungchung(ketqua){
            $("#Checkshet").html(
                //'<div class="column">'+
                    '<div class="card">'+
                        '<img src="images/'+ketqua.id+'.jpg" alt="'+ketqua.id+'" style="width:100%">'+
                        '<div class="container">'+
                            '<h2 id="TenThietBi">'+ketqua.TenThietBi+'</h2>'+
                            '<h3 id="PhanLoai">'+ketqua.PhanLoai+'</h3>'+
                            set5s(ketqua.tieuchuan5s)+
                            setBasic(ketqua.Basic)+
                            '<label class="custom-control-label" for="checkbox-hen">Ghi Chú Bất Thường</label>'+
                            ' <input id="GhiChu" type="text" class="custom-control-input" >'+
                            '<p><button class="button" onclick="writeData()">Check Sheet!!</button></p>'+
                        '</div>'+
                    //'</div>'+
                '</div>')
      document.getElementById("Checkshet").style.display = "block";
    }

    function set5s(value){     
    var cac5s ='<p class="title">5S</p>'
    for(a in value){
     cac5s +='<p>'+value[a]+'</p>'
      }
      return cac5s
    }

    function setBasic(value){     
    var Basic ='<p class="title">Basic</p>'
    for(a in value){
      Basic +='<p>'+value[a]+'</p>'
      }
      return Basic
    }

function writeData(){
  var data = {
    GhiChu:$('#GhiChu').val(),
    PhanLoai: $('#PhanLoai').html(),
    KTVCheck: localStorage.getItem("userName"),
    NgayCheckSheet:TimesClick(),
    TenThietBi:$('#TenThietBi').html()
                     }

  $.ajax({
          url: "https://script.google.com/macros/s/AKfycbxUuJW8nbiKkrZwtM30l6PE-T-gU4QzbgnmdDgp-hbX6-fEnANwZjU4Z_Ae9ZkURCK1/exec",
          method: "GET",
          mode: 'no-cors',
          credentials: 'omit', 
          referrerPolicy: 'no-referrer',
          dataType: "json",
          data: data
                      }) 
   $("#Checkshet").html("")                
}

function TimesClick(data){
                    if(data){var  use=new Date(data);}else{var  use=new Date()}
                      var useinfo = {}
                      var Thang =use.getMonth()+1;
                      var Ngay = use.getDate();
                      var Nam = use.getFullYear();var Gio = use.getHours();
                      var Phut = use.getMinutes();
                      if (Thang<10){Thang="0"+Thang};
                      if (Ngay<10){Ngay="0"+Ngay};
                      if (Gio<10){Gio="0"+Gio};
                      if (Phut<10){Phut="0"+Phut}
                  return Ngay+"/"+Thang+"/"+Nam+" "+Gio+":"+Phut+":00"
                  } 

</script>
</html>
